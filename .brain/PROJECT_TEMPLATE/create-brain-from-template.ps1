# ğŸš€ CREATE BRAIN FROM TEMPLATE - PowerShell Script
# Má»¥c tiÃªu: Setup brain system tá»« template trong < 5 phÃºt

param(
    [Parameter(Mandatory = $true)]
    [string]$ProjectName,
    
    [Parameter(Mandatory = $false)]
    [string]$Team = "Development Team",
    
    [Parameter(Mandatory = $false)]
    [string]$Domain = "SaaS",
    
    [Parameter(Mandatory = $false)]
    [string]$TargetPath = ".brain"
)

# MÃ u sáº¯c cho output
function Write-Success { param($msg) Write-Host "âœ… $msg" -ForegroundColor Green }
function Write-Warning { param($msg) Write-Host "âš ï¸ $msg" -ForegroundColor Yellow }  
function Write-Error { param($msg) Write-Host "âŒ $msg" -ForegroundColor Red }
function Write-Info { param($msg) Write-Host "â„¹ï¸ $msg" -ForegroundColor Cyan }

Write-Info "ğŸš€ Báº®T Äáº¦U SETUP BRAIN SYSTEM CHO Dá»° ÃN: $ProjectName"
$startTime = Get-Date
Write-Info "â±ï¸ Thá»i gian báº¯t Ä‘áº§u: $startTime"

# Kiá»ƒm tra PROJECT_TEMPLATE tá»“n táº¡i
$templatePath = ".brain/PROJECT_TEMPLATE"
if (-not (Test-Path $templatePath)) {
    Write-Error "KhÃ´ng tÃ¬m tháº¥y thÆ° má»¥c $templatePath"
    Write-Info "HÃ£y Ä‘áº£m báº£o báº¡n Ä‘ang cháº¡y script tá»« root directory cá»§a dá»± Ã¡n"
    exit 1
}

Write-Success "TÃ¬m tháº¥y template directory: $templatePath"

# Táº¡o thÆ° má»¥c Ä‘Ã­ch náº¿u chÆ°a tá»“n táº¡i
if (-not (Test-Path $TargetPath)) {
    New-Item -ItemType Directory -Path $TargetPath -Force | Out-Null
    Write-Success "ÄÃ£ táº¡o thÆ° má»¥c: $TargetPath"
}

# Táº¡o thÆ° má»¥c con cáº§n thiáº¿t
$subDirs = @("tasks", "context", "logs/daily")
foreach ($dir in $subDirs) {
    $fullPath = Join-Path $TargetPath $dir
    if (-not (Test-Path $fullPath)) {
        New-Item -ItemType Directory -Path $fullPath -Force | Out-Null
        Write-Success "Táº¡o thÆ° má»¥c: $fullPath"
    }
}

# Copy vÃ  rename template files
$templateFiles = @{
    "TEMPLATE_SCOPE.md"        = "SCOPE.md"
    "TEMPLATE_DOMAIN_MAP.md"   = "DOMAIN_MAP.md" 
    "SAMPLE_ACTIVE_TASKS.json" = "tasks/ACTIVE_TASKS.json"
    "QUICK_START.md"           = "QUICK_START.md"
    "SETUP_GUIDE.md"           = "SETUP_GUIDE.md"
    "INDEX.md"                 = "README.md"
}

Write-Info "ğŸ“ Äang copy vÃ  rename template files..."
$copiedFiles = @()

foreach ($sourceFile in $templateFiles.Keys) {
    $sourcePath = Join-Path $templatePath $sourceFile
    $destFile = $templateFiles[$sourceFile] 
    $destPath = Join-Path $TargetPath $destFile
    
    if (Test-Path $sourcePath) {
        Copy-Item $sourcePath $destPath -Force
        $copiedFiles += $destPath
        Write-Success "Copied: $sourceFile â†’ $destFile"
    }
    else {
        Write-Warning "KhÃ´ng tÃ¬m tháº¥y: $sourceFile"
    }
}

# Táº¡o danh sÃ¡ch placeholder cáº§n thay tháº¿
$currentDate = Get-Date -Format "yyyy-MM-dd"
$currentDateTime = Get-Date -Format "yyyy-MM-dd HH:mm"

$placeholders = @{
    "{{PROJECT_NAME}}"     = $ProjectName
    "{{TEAM_NAME}}"        = $Team
    "{{DOMAIN}}"           = $Domain
    "{{CURRENT_DATE}}"     = $currentDate
    "{{LAST_UPDATED}}"     = $currentDate
    "{{LAST_UPDATE_DATE}}" = $currentDateTime
    "{{VERSION}}"          = "1.0.0"
    "{{STATUS}}"           = "Development"
    "{{CREATION_DATE}}"    = $currentDate
}

Write-Info "ğŸ”„ Äang thay tháº¿ placeholders trong cÃ¡c file..."
$replacedCount = 0

foreach ($filePath in $copiedFiles) {
    if (Test-Path $filePath) {
        $content = Get-Content $filePath -Raw -Encoding UTF8
        $originalContent = $content
        
        foreach ($placeholder in $placeholders.Keys) {
            $replacement = $placeholders[$placeholder]
            $content = $content -replace [regex]::Escape($placeholder), $replacement
        }
        
        if ($content -ne $originalContent) {
            Set-Content $filePath $content -Encoding UTF8
            $replacedCount++
            Write-Success "Updated placeholders in: $(Split-Path $filePath -Leaf)"
        }
    }
}

# Táº¡o CONTEXT_INDEX.md
$contextIndexPath = Join-Path $TargetPath "context/CONTEXT_INDEX.md"
$contextContent = @"
# ğŸ“‹ CONTEXT INDEX - $ProjectName

> **Domain**: $Domain | **Team**: $Team | **Created**: $currentDate

## ğŸ¯ **PROJECT OVERVIEW**
Dá»± Ã¡n **$ProjectName** trong domain **$Domain** Ä‘Æ°á»£c táº¡o tá»« brain template system.

## ğŸ“‚ **CONTEXT FILES**
- **SCOPE.md**: Project scope definition vÃ  goals
- **DOMAIN_MAP.md**: Domain entities vÃ  workflows
- **tasks/ACTIVE_TASKS.json**: Current active tasks tracking

## ğŸš€ **QUICK START**
1. Review SCOPE.md Ä‘á»ƒ hiá»ƒu project goals
2. Check tasks/ACTIVE_TASKS.json cho current tasks
3. Update DOMAIN_MAP.md vá»›i domain-specific info

---
*Auto-generated by create-brain-from-template.ps1*
*Created: $currentDateTime*
"@

Set-Content $contextIndexPath $contextContent -Encoding UTF8
Write-Success "Táº¡o context index: context/CONTEXT_INDEX.md"

# Táº¡o daily log entry
$todayLog = Join-Path $TargetPath "logs/daily/$currentDate.md"
$logContent = @"
# ğŸ“… Daily Log - $currentDate

## ğŸš€ **PROJECT SETUP**
- **Time**: $currentDateTime
- **Project**: $ProjectName
- **Domain**: $Domain
- **Team**: $Team

## âœ… **COMPLETED**
- Brain system Ä‘Æ°á»£c setup tá»« template
- Template files Ä‘Æ°á»£c copy vÃ  customize
- Placeholders Ä‘Æ°á»£c thay tháº¿ tá»± Ä‘á»™ng

## ğŸ“ **NEXT ACTIONS**
- Review SCOPE.md vÃ  update goals if needed
- Add specific tasks vÃ o ACTIVE_TASKS.json
- Customize DOMAIN_MAP.md vá»›i domain entities

---
*Auto-generated by brain template system*
"@

Set-Content $todayLog $logContent -Encoding UTF8
Write-Success "Táº¡o daily log: logs/daily/$currentDate.md"

# TÃ­nh thá»i gian setup
$endTime = Get-Date
$duration = ($endTime - $startTime).TotalSeconds

Write-Info ""
Write-Info "ğŸ‰ HOÃ€N THÃ€NH SETUP BRAIN SYSTEM!"
Write-Info "â±ï¸ Thá»i gian setup: $([math]::Round($duration, 1)) giÃ¢y"
Write-Info "ğŸ“ Files Ä‘Æ°á»£c táº¡o: $($copiedFiles.Count + 2)"  
Write-Info "ğŸ”„ Placeholders Ä‘Æ°á»£c thay: $replacedCount files"

Write-Info ""
Write-Info "ğŸ“‹ **NEXT STEPS**:"
Write-Info "1. Review file SCOPE.md"
Write-Info "2. Update tasks/ACTIVE_TASKS.json vá»›i initial tasks"
Write-Info "3. Customize DOMAIN_MAP.md náº¿u cáº§n"
Write-Info "4. Cháº¡y validate-brain-template.ps1 Ä‘á»ƒ check"

Write-Info ""
Write-Success "ğŸ§  Brain system Ä‘Ã£ sáºµn sÃ ng cho dá»± Ã¡n $ProjectName!"