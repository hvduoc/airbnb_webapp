# =====================================================
# ALERTMANAGER CONFIGURATION
# Airbnb WebApp - Vietnamese Alert Management
# =====================================================

# Global Configuration
global:
  # SMTP settings cho email notifications
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'airbnb-alerts@your-company.com'
  smtp_auth_username: 'airbnb-alerts@your-company.com'
  smtp_auth_password: 'your-app-password'
  smtp_require_tls: true
  
  # Slack webhook URL (optional)
  slack_api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
  
  # Resolve timeout
  resolve_timeout: 5m

# Templates cho Vietnamese notifications
templates:
  - '/etc/alertmanager/templates/*.tmpl'

# =====================================================
# ROUTING RULES - VIETNAMESE ALERT ROUTING
# =====================================================

route:
  # Default receiver
  receiver: 'default-notifications'
  
  # Group alerts by severity v√† category
  group_by: ['alertname', 'severity', 'service']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 24h
  
  # Routing rules cho different alert types
  routes:
    # Critical Database Issues
    - match:
        severity: critical
        category: database
      receiver: 'database-critical'
      group_wait: 10s
      repeat_interval: 30m
      
    # Application Performance Issues  
    - match:
        severity: warning
        category: performance
      receiver: 'performance-warnings'
      group_wait: 2m
      repeat_interval: 2h
      
    # Business Metric Alerts
    - match:
        category: business
      receiver: 'business-alerts'
      group_wait: 1m
      repeat_interval: 6h
      
    # Security Alerts
    - match:
        category: security
      receiver: 'security-alerts'
      group_wait: 5s
      repeat_interval: 15m
      
    # Booking System Issues
    - match:
        service: booking
      receiver: 'booking-system-alerts'
      group_wait: 30s
      repeat_interval: 1h
      
    # Payment Processing Issues
    - match:
        service: payment
      receiver: 'payment-system-alerts'
      group_wait: 15s
      repeat_interval: 30m

# =====================================================
# RECEIVERS - NOTIFICATION CHANNELS
# =====================================================

receivers:
  # Default notification channel
  - name: 'default-notifications'
    email_configs:
      - to: 'admin@your-company.com'
        subject: '[Airbnb WebApp] C·∫£nh b√°o: {{ .GroupLabels.alertname }}'
        body: |
          üö® **C·∫£nh b√°o h·ªá th·ªëng Airbnb WebApp**
          
          **Th·ªùi gian**: {{ .CommonAnnotations.timestamp }}
          **M·ª©c ƒë·ªô**: {{ .CommonLabels.severity }}
          **D·ªãch v·ª•**: {{ .CommonLabels.service }}
          
          **Chi ti·∫øt c·∫£nh b√°o**:
          {{ range .Alerts }}
          - **{{ .Annotations.summary }}**
            M√¥ t·∫£: {{ .Annotations.description }}
            Th·ªùi gian b·∫Øt ƒë·∫ßu: {{ .StartsAt.Format "02/01/2006 15:04:05" }}
          {{ end }}
          
          **H√†nh ƒë·ªông c·∫ßn thi·∫øt**:
          - Ki·ªÉm tra dashboard: http://localhost:3000
          - Xem logs: http://localhost:5601
          - Tr·∫°ng th√°i h·ªá th·ªëng: http://localhost:8000/health
          
          Tr√¢n tr·ªçng,
          H·ªá th·ªëng gi√°m s√°t Airbnb WebApp
        
        headers:
          Subject: '[Airbnb WebApp] C·∫£nh b√°o h·ªá th·ªëng'

  # Critical Database Alerts
  - name: 'database-critical'
    email_configs:
      - to: 'dba@your-company.com, admin@your-company.com'
        subject: '[KH·∫®N C·∫§P] S·ª± c·ªë c∆° s·ªü d·ªØ li·ªáu Airbnb'
        body: |
          üî¥ **S·ª∞ C·ªê KH·∫®N C·∫§P - C∆† S·ªû D·ªÆ LI·ªÜU AIRBNB**
          
          **Th·ªùi gian**: {{ .CommonAnnotations.timestamp }}
          **Lo·∫°i s·ª± c·ªë**: C∆° s·ªü d·ªØ li·ªáu kh√¥ng kh·∫£ d·ª•ng
          
          **Chi ti·∫øt s·ª± c·ªë**:
          {{ range .Alerts }}
          - **{{ .Annotations.summary }}**
            M√¥ t·∫£: {{ .Annotations.description }}
            Database: {{ .Labels.database }}
            Host: {{ .Labels.instance }}
          {{ end }}
          
          **H√ÄNH ƒê·ªòNG NGAY L·∫¨P T·ª®C**:
          1. Ki·ªÉm tra k·∫øt n·ªëi database
          2. Xem logs PostgreSQL: docker logs airbnb_postgres
          3. Ki·ªÉm tra disk space v√† memory
          4. Li√™n h·ªá team DevOps n·∫øu c·∫ßn thi·∫øt
          
          **Links h·ªØu √≠ch**:
          - Database monitoring: http://localhost:3000/d/postgres
          - System health: http://localhost:8000/health
          
          ‚ö†Ô∏è **L∆∞u √Ω**: H·ªá th·ªëng booking c√≥ th·ªÉ b·ªã ·∫£nh h∆∞·ªüng!
        
    # Slack notification cho database issues
    slack_configs:
      - channel: '#airbnb-alerts'
        title: 'üî¥ S·ª± c·ªë c∆° s·ªü d·ªØ li·ªáu Airbnb'
        text: |
          **S·ª± c·ªë KH·∫®N C·∫§P**: C∆° s·ªü d·ªØ li·ªáu Airbnb kh√¥ng kh·∫£ d·ª•ng
          **Th·ªùi gian**: {{ .CommonAnnotations.timestamp }}
          
          {{ range .Alerts }}
          ‚Ä¢ {{ .Annotations.summary }}
          {{ end }}
          
          üë• <@channel> - C·∫ßn x·ª≠ l√Ω ngay l·∫≠p t·ª©c!

  # Performance Warning Alerts
  - name: 'performance-warnings'
    email_configs:
      - to: 'dev-team@your-company.com'
        subject: '[C·∫£nh b√°o] Hi·ªáu su·∫•t h·ªá th·ªëng Airbnb'
        body: |
          ‚ö†Ô∏è **C·∫¢NH B√ÅO HI·ªÜU SU·∫§T - AIRBNB WEBAPP**
          
          **Th·ªùi gian**: {{ .CommonAnnotations.timestamp }}
          **Lo·∫°i c·∫£nh b√°o**: Hi·ªáu su·∫•t h·ªá th·ªëng
          
          **Chi ti·∫øt**:
          {{ range .Alerts }}
          - **{{ .Annotations.summary }}**
            M√¥ t·∫£: {{ .Annotations.description }}
            Gi√° tr·ªã hi·ªán t·∫°i: {{ .Annotations.value }}
            Ng∆∞·ª°ng c·∫£nh b√°o: {{ .Annotations.threshold }}
          {{ end }}
          
          **H√†nh ƒë·ªông ƒë∆∞·ª£c ƒë·ªÅ xu·∫•t**:
          - Ki·ªÉm tra CPU v√† memory usage
          - Xem slow queries trong database
          - Theo d√µi response time c·ªßa API
          - Ki·ªÉm tra s·ªë l∆∞·ª£ng concurrent users
          
          **Monitoring dashboards**:
          - Application metrics: http://localhost:3000/d/app-performance
          - Database performance: http://localhost:3000/d/postgres-performance

  # Business Metric Alerts
  - name: 'business-alerts'
    email_configs:
      - to: 'business-team@your-company.com, admin@your-company.com'
        subject: '[Kinh doanh] C·∫£nh b√°o ch·ªâ s·ªë Airbnb'
        body: |
          üìä **C·∫¢NH B√ÅO CH·ªà S·ªê KINH DOANH - AIRBNB**
          
          **Th·ªùi gian**: {{ .CommonAnnotations.timestamp }}
          **Lo·∫°i c·∫£nh b√°o**: Ch·ªâ s·ªë kinh doanh
          
          **Chi ti·∫øt**:
          {{ range .Alerts }}
          - **{{ .Annotations.summary }}**
            M√¥ t·∫£: {{ .Annotations.description }}
            Gi√° tr·ªã: {{ .Annotations.value }}
            M·ª©c b√¨nh th∆∞·ªùng: {{ .Annotations.expected }}
          {{ end }}
          
          **C√°c ch·ªâ s·ªë c·∫ßn theo d√µi**:
          - S·ªë l∆∞·ª£ng booking m·ªõi
          - Doanh thu theo ng√†y/tu·∫ßn
          - T·ª∑ l·ªá h·ªßy booking
          - Th·ªùi gian ph·∫£n h·ªìi trung b√¨nh
          
          **Dashboard kinh doanh**:
          - Revenue tracking: http://localhost:3000/d/revenue
          - Booking analytics: http://localhost:3000/d/bookings

  # Security Alerts
  - name: 'security-alerts'
    email_configs:
      - to: 'security@your-company.com, admin@your-company.com'
        subject: '[B·∫¢O M·∫¨T] C·∫£nh b√°o an ninh Airbnb'
        body: |
          üõ°Ô∏è **C·∫¢NH B√ÅO B·∫¢O M·∫¨T - AIRBNB WEBAPP**
          
          **Th·ªùi gian**: {{ .CommonAnnotations.timestamp }}
          **Lo·∫°i c·∫£nh b√°o**: An ninh h·ªá th·ªëng
          **M·ª©c ƒë·ªô ∆∞u ti√™n**: {{ .CommonLabels.severity }}
          
          **Chi ti·∫øt s·ª± ki·ªán**:
          {{ range .Alerts }}
          - **{{ .Annotations.summary }}**
            M√¥ t·∫£: {{ .Annotations.description }}
            IP address: {{ .Labels.source_ip }}
            User agent: {{ .Labels.user_agent }}
          {{ end }}
          
          **H√†nh ƒë·ªông khuy·∫øn ngh·ªã**:
          - Ki·ªÉm tra access logs
          - Xem chi ti·∫øt trong Kibana
          - Theo d√µi IP addresses ƒë√°ng ng·ªù
          - Ki·ªÉm tra authentication logs
          
          **Security monitoring**:
          - Access logs: http://localhost:5601
          - Security dashboard: http://localhost:3000/d/security

  # Booking System Alerts
  - name: 'booking-system-alerts'
    email_configs:
      - to: 'booking-team@your-company.com'
        subject: '[ƒê·∫∑t ph√≤ng] C·∫£nh b√°o h·ªá th·ªëng booking'
        body: |
          üè† **C·∫¢NH B√ÅO H·ªÜ TH·ªêNG ƒê·∫∂T PH√íNG**
          
          **Th·ªùi gian**: {{ .CommonAnnotations.timestamp }}
          **D·ªãch v·ª•**: H·ªá th·ªëng ƒë·∫∑t ph√≤ng
          
          **Chi ti·∫øt**:
          {{ range .Alerts }}
          - **{{ .Annotations.summary }}**
            M√¥ t·∫£: {{ .Annotations.description }}
            Property ID: {{ .Labels.property_id }}
            Booking ID: {{ .Labels.booking_id }}
          {{ end }}
          
          **Impact ƒë·ªëi v·ªõi kh√°ch h√†ng**:
          - C√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn vi·ªác ƒë·∫∑t ph√≤ng m·ªõi
          - Kh√°ch h√†ng c√≥ th·ªÉ g·∫∑p l·ªói khi thanh to√°n
          - C·∫ßn ki·ªÉm tra v√† x·ª≠ l√Ω nhanh ch√≥ng
          
          **Monitoring**:
          - Booking dashboard: http://localhost:3000/d/bookings
          - API health: http://localhost:8000/health

  # Payment System Alerts  
  - name: 'payment-system-alerts'
    email_configs:
      - to: 'payment-team@your-company.com, finance@your-company.com'
        subject: '[Thanh to√°n] C·∫£nh b√°o h·ªá th·ªëng thanh to√°n'
        body: |
          üí≥ **C·∫¢NH B√ÅO H·ªÜ TH·ªêNG THANH TO√ÅN**
          
          **Th·ªùi gian**: {{ .CommonAnnotations.timestamp }}
          **D·ªãch v·ª•**: X·ª≠ l√Ω thanh to√°n
          **M·ª©c ƒë·ªô**: {{ .CommonLabels.severity }}
          
          **Chi ti·∫øt**:
          {{ range .Alerts }}
          - **{{ .Annotations.summary }}**
            M√¥ t·∫£: {{ .Annotations.description }}
            Payment ID: {{ .Labels.payment_id }}
            Amount: {{ .Labels.amount }} VND
          {{ end }}
          
          **Impact t√†i ch√≠nh**:
          - C√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn doanh thu
          - C·∫ßn ki·ªÉm tra giao d·ªãch th·∫•t b·∫°i
          - Li√™n h·ªá ng√¢n h√†ng n·∫øu c·∫ßn thi·∫øt
          
          **H√†nh ƒë·ªông c·∫ßn thi·∫øt**:
          - Ki·ªÉm tra payment gateway status
          - Xem transaction logs
          - Verify v·ªõi banking partner
          
          **Financial monitoring**:
          - Payment dashboard: http://localhost:3000/d/payments
          - Transaction logs: http://localhost:5601

# =====================================================
# INHIBIT RULES - PREVENT ALERT SPAM
# =====================================================

inhibit_rules:
  # Inhibit warning n·∫øu c√≥ critical alert c√πng service
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['service', 'instance']
    
  # Inhibit lower priority alerts during maintenance
  - source_match:
      alertname: 'MaintenanceMode'
    target_match_re:
      severity: 'warning|info'